<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./pstyle/otp.css" />
    <link rel = "icon" href = "https://i.pinimg.com/originals/b9/f3/79/b9f379dc190685c443ac37fdfee6a5dc.png" type = "image/x-icon">
    <title>Document</title>
    <link rel="stylesheet" href="./pstyle/payment.css" />
</head>
<body>
  <div id="lmodal-otp">
    <form>
      <div id="main">
        <div class="row">
          <div class="col-50">
            <!-- <div>Enter OTP</div>
    <input type="number" id="otp" /> -->
    
            <label>Enter OTP</label>
            <input type="password" id="otp" placeholder="OTP" required />
            <input type="submit" value="Validate OTP" class="btn" />
          </div>
        </div>
      </div>
    </form>
  </div>
    <div class="con">
    <div id="pnavbar">
        <div class="imgp">
            <img src="https://www.logo.wine/a/logo/Snapdeal/Snapdeal-White-Dark-Background-Logo.wine.svg" alt="" width="150px">
        </div>
        <div class="pp">
            <p>100% Payment Protection,Easy Returns Policy</p>
        </div>
    </div>
    <div class="lowerpart">
          <div class="bl">
               <div class="login">
                   <div style="margin-top: 10px;margin-left: 10px;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Eo_circle_green_white_checkmark.svg/2048px-Eo_circle_green_white_checkmark.svg.png" height="30px" width="30px" alt="">
                   </div>           
                <p class="ppl">1.LOGIN</p>
               </div>
               <div class="dv">
                <div style="margin-top: 10px;margin-left: 10px;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Eo_circle_green_white_checkmark.svg/2048px-Eo_circle_green_white_checkmark.svg.png" height="30px" width="30px" alt="">
                   </div>           
                <p class="ppl">2.DELIVERY ADRESS</p>
               </div>
               <div class="rv">
                <div style="margin-top: 10px;margin-left: 10px;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Eo_circle_green_white_checkmark.svg/2048px-Eo_circle_green_white_checkmark.svg.png" height="30px" width="30px" alt="">
                   </div>           
                <p class="ppl">3.REVIEW ORDER</p>
               </div>
               <div class="mp">
                   <p class="ppo">4.Make payment</p>
               </div>
               <div class="payment">
                   <div class="payl">
                      <div>
                        <p class="ppl">Credit Card</p>
                      </div>
                      <div>
                        <p class="ppl">Debit Card</p>
                      </div>
                      <div>
                        <p class="ppl">Net Banking</p>
                      </div>
                      <div>
                        <p class="ppl">Cash on Delivery</p>
                      </div>
                      <div>
                        <p class="ppl">EMI</p>
                      </div>
                      <div> <p class="ppl">e Voucher</p></div>
                      <div> <p class="ppl">UPI</p></div> 
                   </div>
                   <div class="saami">
                       <div class="bankof">
                        <div> <p class="ppl">Bank Offer</p></div>
                        <div><p class="rio">Get Discount on Payment Modes</p></div>
                        <div class="green">
                            <p class="pop">20% instant discount</p>
                            <p class="push">Using sbi bank</p>
                        </div>
                       </div>
                       <div class="jop">
                          <div class="jop2"><p>Pay Using Debit Card</p></div> 
                           
                       </div>
                       <div>
                           <div style="display: flex;">
                              <p style="margin-left: 10px;font-size: 15px;color:gray">Card Number</p>
                              <input type="number" name="ahs" id="lego" placeholder="Card Number">
                           </div>
                           <div style="display: flex;">
                            <p style="margin-left: 10px;font-size: 15px;color:gray">Expiry Date</p>
                            <input type="number" name="ahs" id="leg" placeholder="MM">
                            <input type="number" name="ahs" id="leg" placeholder="YY">
                            <p style="margin-left: 10px;font-size: 15px;color:gray">CVV</p>
                            <input type="password" name="ahs" id="leg" placeholder="CVV">
                         </div>
                         <button class="bt">PAY</button>
                       </div>
                   </div>
               </div>
          </div>
          <div class="br">
              <div class="br1">
                  <p>SUMMARY</p>
              </div>
              <div class="br1">
                <p>Total: Rs.<span id="ladd"></span></p>
                <p>Delivery Charges <span style="color: green; font-size: 13px;">.Free</span></p>
                <h1 style="font-size: 20px;">You Pay: <span style="color: green;">Rs.<span id="ltotal"></span></span></h1>
              </div>
          </div>
    </div>
</div>
</body>
</html>


<script>
  document.querySelector(".imgp").onclick = ()=>{
    window.location.href = "home.html"
  }
  let user = JSON.parse(localStorage.getItem("userData"))
  document.getElementById("ltotal").innerHTML = user.totalPrice
  document.getElementById("ladd").innerHTML = user.totalPrice

    document.querySelector(".bt").addEventListener("click", checkout);
  
    function checkout() {
      let input = document.getElementsByTagName("input")
      if(input[2].value.length!==12){
        alert("Please provide valid card number")
        return;
      }
      if(input[3].value>12){
        alert("Please provide valid month")
        return;
      }
      if(input[4].value<=2022){
        alert("You can't order by using this card")
        return;
      }
      if(input[5].value.length!==3){
        alert("Please provide valid CVV number")
        return;
      }
      window.alert("OTP Sent to your Mobile Number");
      document.getElementById("lmodal-otp").style.display = "block"
    }

document.querySelector("form").addEventListener("submit", validate);

function validate(event) {
  event.preventDefault();
  var check = document.querySelector("#otp").value;
  if (check == "1234") {
    localStorage.removeItem("cartData");
    localStorage.removeItem("ads");
    cartDelete()
    window.alert("Payment Successful");
    window.location.href = "home.html";
  } else {
    window.alert("Invalid OTP");
  }
}
console.log('user:', user)
async function cartDelete(){
  try{
    let res = await fetch(`http://localhost:9345/carts/${user.user._id}`,{
        method:"DELETE",
        headers:{
            'Content-Type':'application/json'
        }
    })
    let data = await res.json()
    return data;
  } catch(err){
    console.log({Error:err.message})
  }
}
  </script>